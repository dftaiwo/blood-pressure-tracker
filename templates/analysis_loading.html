{% extends "base.html" %}

{% block content %}
<h1>Analyzing Blood Pressure Readings</h1>
<div class="text-center">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3" id="status-message">Analysis in progress...</p>
</div>

<script>
function checkStatus() {
    fetch('/analysis_status/{{ task_id }}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('status-message').textContent = data.status;
            if (data.state === 'SUCCESS') {
                window.location.href = "{{ url_for('analyze_readings') }}";
            } else if (data.state === 'FAILURE') {
                alert('Analysis failed: ' + data.error);
            } else {
                setTimeout(checkStatus, 1000);
            }
        });
}

checkStatus();
</script>
{% endblock %}